# Render Deployment Instructions

## Prerequisites
1. A GitHub repository with your code
2. A Render account (free at render.com)
3. TradingView account credentials

## Troubleshooting SQLAlchemy Issues

**If you encounter SQLAlchemy compatibility errors:**

1. **Run the fix script:**
   ```bash
   python fix_render_deployment.py
   ```

2. **Common SQLAlchemy Error:**
   ```
   AssertionError: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly
   ```
   
   **Solution:** This occurs with Python 3.13+. Use Python 3.11.9 instead:
   - Update `runtime.txt` to `python-3.11.9`
   - Use SQLAlchemy 2.0.32+ for better compatibility

## Step-by-Step Deployment

### 1. Prepare Your Repository
```bash
# Fix any compatibility issues
python fix_render_deployment.py

# Copy render_requirements.txt to requirements.txt (if not done by fix script)
cp render_requirements.txt requirements.txt

# Run the secrets transfer script (optional, for local testing)
python secrets_to_env.py
```

### 2. Create Render Services

#### Option A: Using render.yaml (Recommended)
1. Push your code to GitHub
2. Go to Render Dashboard
3. Click "New" → "Blueprint"
4. Connect your GitHub repository
5. Render will automatically detect the `render.yaml` file

#### Option B: Manual Setup
1. **Create PostgreSQL Database:**
   - Go to Render Dashboard
   - Click "New" → "PostgreSQL"
   - Name: `tradingview-database`
   - Plan: Free
   - Note the connection details

2. **Create Web Service:**
   - Click "New" → "Web Service"
   - Connect your GitHub repository
   - Build Command: `pip install -r requirements.txt`
   - Start Command: `gunicorn --bind 0.0.0.0:$PORT main:app`
   - Environment: Python 3

### 3. Set Environment Variables
In your Render web service dashboard, add these environment variables:

**Required:**
- `TRADINGVIEW_USERNAME`: Your TradingView username
- `TRADINGVIEW_PASSWORD`: Your TradingView password
- `DATABASE_URL`: (Auto-generated by Render PostgreSQL service)
- `SESSION_SECRET`: A secure random string (generate with: `python -c "import secrets; print(secrets.token_hex(32))"`)

**Optional:**
- `FLASK_ENV`: `production`
- `PYTHONUNBUFFERED`: `1`
- `SESSION_TIMEOUT`: `3600`
- `LOG_LEVEL`: `INFO`

### 4. Database Setup
The database tables will be created automatically when the app starts.

### 5. Access Your App
- Your app will be available at: `https://your-service-name.onrender.com`
- Admin login: `admin@tradingview.com` / `admin123` (change in production)

## Important Notes

### Security
- Change the default admin password immediately after deployment
- Use a strong `SESSION_SECRET`
- Never commit secrets to your repository

### Database
- Free Render PostgreSQL databases sleep after 90 days of inactivity
- For production, consider upgrading to a paid plan

### Troubleshooting

**Common Issues:**

1. **SQLAlchemy TypingOnly Error:**
   - Caused by Python 3.13 compatibility
   - Solution: Use Python 3.11.9 (set in runtime.txt)
   - Run: `python fix_render_deployment.py`

2. **Gunicorn Timeout:**
   - Increase timeout in Procfile: `--timeout 60`
   - Reduce workers: `--workers 1`

3. **Database Connection:**
   - Check DATABASE_URL environment variable
   - Ensure PostgreSQL service is running
   - Verify database credentials

4. **General Steps:**
   - Check deployment logs in Render dashboard
   - Ensure all environment variables are set correctly
   - Verify TradingView credentials are valid
   - Use the fix script: `python fix_render_deployment.py`

### File Structure for Render
```
your-project/
├── app.py                 # Flask application
├── main.py               # Entry point
├── routes.py             # Route definitions
├── models.py             # Database models
├── tradingview.py        # TradingView API integration
├── config.py             # Configuration
├── requirements.txt      # Python dependencies
├── render.yaml           # Render configuration
├── Procfile             # Process file
├── .env.example         # Environment template
├── templates/           # HTML templates
├── static/             # CSS, JS, images
└── deploy_instructions.md # This file
```

## Environment Variables Reference

| Variable | Description | Required | Default |
|----------|-------------|----------|---------|
| `TRADINGVIEW_USERNAME` | TradingView account username | Yes | - |
| `TRADINGVIEW_PASSWORD` | TradingView account password | Yes | - |
| `DATABASE_URL` | PostgreSQL connection string | Yes | Auto-generated |
| `SESSION_SECRET` | Flask session secret key | Yes | - |
| `FLASK_ENV` | Flask environment | No | `production` |
| `SESSION_TIMEOUT` | Session timeout in seconds | No | `3600` |
| `LOG_LEVEL` | Logging level | No | `INFO` |

## Support
For issues with deployment, check:
1. Render build logs
2. Application logs
3. Environment variable configuration
4. Database connection status